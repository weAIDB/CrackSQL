<template>
  <div id="Sidebar" class="reset-menu-style columnBC relative">
    <div class="columnSC">
      <el-tooltip
          class="box-item"
          effect="dark"
          :content="$t('layout.sidebar.tooltip.newChat')"
          placement="right"
      >
        <div id="dashboard"
             class="columnCC"
             style="margin: 20px 0; flex-shrink: 0; padding-bottom: 20px; border-bottom: 1px solid #e5e5e5; cursor: pointer"
             @click="goToHome">
          <svg t="1739875385256" class="icon" viewBox="0 0 1024 1024" width="36" height="36"><path d="M863.307169 1023.679132h-223.713088a63.918025 63.918025 0 0 1-63.918025-63.918026v-191.754075a63.918025 63.918025 0 0 0-127.83605 0v191.754075a63.918025 63.918025 0 0 1-63.918025 63.918026h-191.754076c-63.087091 6.008294-127.83605-67.721148-127.83605-111.856544V575.869447A65.164427 65.164427 0 0 1 19.84491 464.364453l108.660642-108.660643c0-1.022688-0.31959-2.013418-0.31959-3.195901v-223.713088a63.918025 63.918025 0 0 1 127.83605 0v99.072939L464.618487 19.207367a65.611853 65.611853 0 0 1 58.133444-18.088802 63.566476 63.566476 0 0 1 48.322027 18.440351l433.236375 433.236374a63.918025 63.918025 0 0 1-45.126126 109.267864v349.759434c0 44.135396-51.741641 111.856544-95.877038 111.856544m-341.961434-875.676945l-348.129524 348.353237h21.092948a62.831419 62.831419 0 0 0-2.26909 15.979506v319.590126a79.482064 79.482064 0 0 0 31.959013 63.918025h95.877038v-127.83605a65.164427 65.164427 0 0 1 1.757745-14.413515 96.036833 96.036833 0 0 1-1.629909-17.545498v-63.918025a95.877038 95.877038 0 0 1 95.877037-95.877037h191.754076a95.877038 95.877038 0 0 1 95.877037 95.877037v63.918025a96.036833 96.036833 0 0 1-1.757745 17.545498 65.164427 65.164427 0 0 1 1.757745 14.413515v127.83605h95.877038a79.482064 79.482064 0 0 0 31.959013-63.918025v-319.590126a62.831419 62.831419 0 0 0-2.26909-15.979506h38.350815z" fill="var(--el-color-primary)" p-id="4631"></path></svg>
        </div>
      </el-tooltip>
      <div class="columnSC" style="width: 100%; position: relative;">
        <sidebar-item v-for="route in allRoutes" :key="route.path" :item="route" :base-path="route.path"
                      :active-path="activeMenu"/>
      </div>
    </div>

    <div class="columnCC">
      <!-- <el-popconfirm :title="$t('layout.sidebar.tooltip.logoutConfirm')" @confirm="onExitClick">
        <template #reference>
          <div class="columnCC"
               style="margin-bottom: 10px; cursor: pointer; background: RGBA(232, 231, 230, 1.00); padding: 2px; border-radius: 8px"
          >
            <svg t="1714963942080" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 p-id="8799" width="32" height="32">
              <path
                  d="M662.1 670.2c-13.7 0-24.8 11.1-24.8 24.8v64.5c0 13.2-14.6 26.2-27.8 26.2H285.2c-13.2 0-27.4-13-27.4-26.2V267.8c0-13.2 14.2-26.8 27.4-26.8h324.4c13.2 0 27.8 13.6 27.8 26.8v62.5c0 13.7 11.1 24.8 24.8 24.8 13.7 0 24.8-11.1 24.8-24.8v-62.5c0-40.5-36.8-76.3-77.3-76.3H285.2c-40.5 0-76.9 35.8-76.9 76.3v491.7c0 40.5 36.4 75.7 76.9 75.7h324.4c40.5 0 77.3-35.2 77.3-75.7V695c0-13.7-11.1-24.8-24.8-24.8z"
                  fill="#1A1A1A" p-id="8800"></path>
              <path
                  d="M666.3 488.5H484.7c-13.7 0-24.8 11.1-24.8 24.8 0 13.7 11.1 24.8 24.8 24.8h181.6c13.7 0 24.8-11.1 24.8-24.8-0.1-13.7-11.2-24.8-24.8-24.8z"
                  fill="#E73F32" p-id="8801"></path>
              <path
                  d="M797.5 464.7l-71.1-71.1c-9.7-9.7-25.3-9.7-35 0s-9.7 25.3 0 35l71.1 71.2c3.7 3.7 5.8 8.7 5.8 13.9 0 5.3-2.1 10.2-5.8 14l-71.1 71.1c-9.7 9.7-9.7 25.3 0 35 4.8 4.8 11.2 7.3 17.5 7.3 6.3 0 12.7-2.4 17.5-7.3l71.1-71.1c13.1-13.1 20.3-30.5 20.3-49 0-18.6-7.2-36-20.3-49z"
                  fill="#E73F32" p-id="8802"></path>
            </svg>
          </div>
        </template>
      </el-popconfirm> -->
      <el-tooltip
          class="box-item"
          effect="dark"
          :content="$t('layout.sidebar.tooltip.feedback')"
          placement="right"
      >
        <div class="columnCC"
             style="margin-bottom: 15px; cursor: pointer; background: RGBA(232, 231, 230, 1.00); padding: 4px; border-radius: 8px"
             @click="onGotoGitHubIssueClick">
          <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="24" height="24">
            <path
                d="M222.6176 835.8912h410.5728l312.3712-312.3712c16.7936-16.7424 26.0096-39.0656 26.0096-62.7712s-9.216-46.0288-26.0096-62.7712L651.008 103.424a88.14592 88.14592 0 0 0-62.7712-26.0096c-23.7056 0-46.0288 9.216-62.7712 26.0096l-454.912 454.912c-34.6112 34.6112-34.6112 90.9312 0 125.5424l152.064 152.0128z m26.7776-261.4272l300.2368-9.3184a19.01056 19.01056 0 0 0 18.432-19.6096l-8.7552-280.9344c-0.4096-14.1312 10.6496-25.9584 24.7808-26.368 14.1824-0.3072 25.9584 10.6496 26.368 24.7808l8.7552 280.9344c1.1776 38.7072-29.3376 71.168-68.0448 72.3968l-300.2368 9.3184h-0.8192a25.6512 25.6512 0 0 1-25.6-24.7808c-0.3584-14.1824 10.752-26.0096 24.8832-26.4192zM920.7808 883.0976H82.688c-14.1312 0-25.6 11.4688-25.6 25.6s11.4688 25.6 25.6 25.6h838.144c14.1312 0 25.6-11.4688 25.6-25.6s-11.52-25.6-25.6512-25.6z"
                fill="#15BC84"/>
            <path
                d="M239.2576 883.0976h-27.5968c66.9696 29.8496 141.6704 45.1584 219.904 41.9328 64-2.6112 124.6208-17.3568 179.7632-41.9328H239.2576zM588.2368 77.3632c-23.7056 0-46.0288 9.216-62.7712 26.0096l-454.912 454.912c-34.6112 34.6112-34.6112 90.9312 0 125.5424l152.064 152.0128h410.5728l243.712-243.712c18.9952-55.808 28.2112-115.9168 25.6512-178.3296-0.9216-22.4768-3.3792-44.544-7.168-66.0992l-244.3264-244.3264a88.4736 88.4736 0 0 0-62.8224-26.0096z m-37.0176 538.9312l-300.2368 9.3184h-0.8192a25.6512 25.6512 0 0 1-25.6-24.7808c-0.4096-14.1312 10.6496-25.9584 24.7808-26.368l300.2368-9.3184a19.01056 19.01056 0 0 0 18.432-19.6096l-8.7552-280.9344c-0.4096-14.1312 10.6496-25.9584 24.7808-26.368 14.1824-0.3072 25.9584 10.6496 26.368 24.7808l8.7552 280.9344c1.28 38.656-29.2352 71.1168-67.9424 72.3456z"
                fill="#15BC84"/>
            <path
                d="M811.4176 263.7824l-160.4096-160.4096a88.14592 88.14592 0 0 0-62.7712-26.0096c-23.7056 0-46.0288 9.216-62.7712 26.0096l-454.912 454.912c-32.9728 32.9728-34.4576 85.6064-4.608 120.4736 79.7184 48.2304 174.0288 74.3424 274.0736 70.2464 262.5536-10.752 468.5312-225.536 471.3984-485.2224z m-260.1984 352.512l-300.2368 9.3184h-0.8192a25.6512 25.6512 0 0 1-25.6-24.7808c-0.4096-14.1312 10.6496-25.9584 24.7808-26.368l300.2368-9.3184a19.01056 19.01056 0 0 0 18.432-19.6096l-8.7552-280.9344c-0.4096-14.1312 10.6496-25.9584 24.7808-26.368 14.1824-0.3072 25.9584 10.6496 26.368 24.7808l8.7552 280.9344c1.28 38.656-29.2352 71.1168-67.9424 72.3456z"
                fill="#15BC84"/>
            <path
                d="M651.008 103.3728a88.14592 88.14592 0 0 0-62.7712-26.0096c-23.7056 0-46.0288 9.216-62.7712 26.0096l-454.912 454.912c-1.9456 1.9456-3.7376 3.9424-5.4272 6.0416a489.79456 489.79456 0 0 0 163.4304 20.8384c0.3072 0 0.6144-0.0512 0.9728-0.0512 4.5056-6.1952 11.6224-10.3936 19.8656-10.6496l73.3184-2.304c94.3104-22.4256 177.664-71.8336 241.8688-139.3664l-5.2224-168.2432c-0.4096-14.1312 10.6496-25.9584 24.7808-26.368 14.1824-0.3072 25.9584 10.6496 26.368 24.7808l3.3792 109.0048c44.544-64.9216 73.8816-140.9024 82.9952-222.6688l-45.8752-45.9264z"
                fill="#15BC84"/>
            <path d="M224.9216 403.9168c164.3008-36.352 293.3248-162.304 335.872-322.2016-13.1584 4.2496-25.2416 11.5712-35.328 21.6576l-300.544 300.544z"
                  fill="#15BC84"/>
          </svg>
        </div>
      </el-tooltip>
      <el-tooltip
          class="box-item"
          effect="dark"
          :content="$t('layout.sidebar.tooltip.github')"
          placement="right"
      >
        <div class="columnCC"
             style="margin-bottom: 15px; cursor: pointer; background: RGBA(232, 231, 230, 1.00); padding: 4px; border-radius: 8px"
             @click="onGotoGitHubClick">
          <svg t="1732003027727" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="18782" width="24" height="23">
            <path
                d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9 23.5 23.2 38.1 55.4 38.1 91v112.5c0.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"
                p-id="18783"></path>
          </svg>
        </div>
      </el-tooltip>
      <el-tooltip
          class="box-item"
          effect="dark"
          :content="$t('layout.sidebar.tooltip.language')"
          placement="right"
      >
        <div class="columnCC"
             style="margin-bottom: 15px; cursor: pointer; background: RGBA(232, 231, 230, 1.00); padding: 4px; border-radius: 8px"
             @click="onLanguageClick">
          <svg t="1709001310119" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
               p-id="22841" width="24" height="24">
            <path
                d="M381.5 483.7c0-53.1 43.2-96.3 96.3-96.3h85v-187c0-9.4-7.6-17-17-17H137.9c-9.4 0-17 7.6-17 17v283.3c0 9.4 7.6 17 17 17h73.6v32.1l64.3-32.1h105.7v-17z"
                fill="#9ADCCF" p-id="22842"/>
            <path
                d="M747.7 784h-270c-9.4 0-17-7.6-17-17V483.7c0-9.4 7.6-17 17-17h407.9c9.4 0 17 7.6 17 17V767c0 9.4-7.6 17-17 17H812v32.1L747.7 784z"
                fill="#FFF370" p-id="22843"/>
            <path
                d="M341.8 523.4h-56.7c-2.6 0-5.2 0.6-7.6 1.8l-88.7 44.4v-29.2c0-9.4-7.6-17-17-17h-34c-21.9 0-39.7-17.8-39.7-39.7V200.5c0-21.9 17.8-39.7 39.7-39.7h407.9c21.9 0 39.7 17.8 39.7 39.7v147.3c0 9.4 7.6 17 17 17s17-7.6 17-17V200.5c0-40.6-33-73.6-73.6-73.6H137.9c-40.6 0-73.6 33-73.6 73.6v283.3c0 40.6 33 73.6 73.6 73.6h17V597c0 5.9 3 11.4 8.1 14.5 2.7 1.7 5.8 2.5 8.9 2.5 2.6 0 5.2-0.6 7.6-1.8l109.7-54.9h52.6c9.4 0 17-7.6 17-17 0-9.3-7.6-16.9-17-16.9z"
                fill="#4F3D3B" p-id="22844"/>
            <path
                d="M885.7 410.1h-65.8c-9.4 0-17 7.6-17 17s7.6 17 17 17h65.8c21.9 0 39.7 17.8 39.7 39.7V767c0 21.9-17.8 39.7-39.7 39.7h-34c-9.4 0-17 7.6-17 17v29.2L746 808.4c-2.4-1.2-5-1.8-7.6-1.8H477.8c-21.9 0-39.7-17.8-39.7-39.7V483.7c0-21.9 17.8-39.7 39.7-39.7h249.3c9.4 0 17-7.6 17-17s-7.6-17-17-17H477.8c-12.9 0-25 3.3-35.5 9.2l-85-180.7c-2.8-6-8.8-9.8-15.4-9.8s-12.6 3.8-15.4 9.8l-90.6 192.6c-4 8.5-0.3 18.6 8.1 22.6 8.5 4 18.6 0.3 22.6-8.1l19.4-41.2h111.7l18.4 39.1c-7.6 11.6-12 25.4-12 40.2V767c0 40.6 33 73.6 73.6 73.6h256.6L844 895.5c2.4 1.2 5 1.8 7.6 1.8 3.1 0 6.2-0.9 8.9-2.5 5-3.1 8.1-8.6 8.1-14.5v-39.7h17c40.6 0 73.6-33 73.6-73.6V483.7c0.1-40.6-32.9-73.6-73.5-73.6z m-583.8-39.7l39.9-84.7 39.9 84.7h-79.8zM358 733.9c-0.2-0.6-0.3-1.1-0.5-1.7-0.2-0.6-0.6-1.1-0.9-1.7-0.2-0.4-0.4-0.8-0.7-1.2-1.2-1.9-2.9-3.5-4.7-4.7-0.4-0.3-0.8-0.4-1.2-0.6-0.6-0.3-1.1-0.7-1.7-0.9-0.5-0.2-1.1-0.3-1.7-0.5-0.5-0.2-1-0.3-1.5-0.4-1.1-0.2-2.2-0.3-3.3-0.3H241c-21.9 0-39.7-17.8-39.7-39.7v-17.1c0-9.4-7.6-17-17-17s-17 7.6-17 17V682c0 40.6 33 73.6 73.6 73.6h59.8L284.5 772c-6.6 6.6-6.6 17.4 0 24 3.3 3.3 7.7 5 12 5s8.7-1.7 12-5l45.3-45.3c0.8-0.8 1.5-1.7 2.1-2.6 0.3-0.4 0.4-0.8 0.7-1.2 0.3-0.6 0.6-1.1 0.9-1.7 0.2-0.5 0.4-1.1 0.5-1.7 0.1-0.5 0.3-1 0.4-1.5 0.4-2.2 0.4-4.5 0-6.7 0-0.5-0.2-1-0.4-1.4z m307.5-511.6c0.2 0.6 0.3 1.1 0.5 1.7 0.2 0.6 0.6 1.1 0.9 1.7 0.2 0.4 0.4 0.8 0.7 1.2 1.2 1.9 2.9 3.5 4.7 4.7 0.4 0.3 0.8 0.4 1.2 0.6 0.6 0.3 1.1 0.7 1.7 0.9 0.5 0.2 1.1 0.3 1.7 0.5 0.5 0.2 1 0.3 1.5 0.4 1.1 0.2 2.2 0.3 3.3 0.3h100.8c21.9 0 39.7 17.8 39.7 39.7v73.6c0 9.4 7.6 17 17 17s17-7.6 17-17V274c0-40.6-33-73.6-73.6-73.6h-59.8l16.3-16.3c6.6-6.6 6.6-17.4 0-24-6.6-6.6-17.4-6.6-24 0l-45.3 45.3c-0.8 0.8-1.5 1.7-2.1 2.6-0.3 0.4-0.4 0.8-0.7 1.2-0.3 0.6-0.6 1.1-0.9 1.7-0.2 0.5-0.4 1.1-0.5 1.7-0.1 0.5-0.3 1-0.4 1.5-0.4 2.2-0.4 4.5 0 6.7 0 0.5 0.2 1 0.3 1.5z"
                fill="#4F3D3B" p-id="22845"/>
            <path
                d="M681.7 750c9.4 0 17-7.6 17-17v-45.3H778c9.4 0 17-7.6 17-17V580c0-9.4-7.6-17-17-17h-79.3v-45.3c0-9.4-7.6-17-17-17s-17 7.6-17 17V563h-79.3c-9.4 0-17 7.6-17 17v90.6c0 9.4 7.6 17 17 17h79.3V733c0 9.4 7.6 17 17 17z m17-153H761v56.7h-62.3V597z m-96.3 56.7V597h62.3v56.7h-62.3z"
                fill="#4F3D3B" p-id="22846"/>
          </svg>
        </div>
      </el-tooltip>
      <el-tooltip
          class="box-item"
          effect="dark"
          :content="$t('layout.sidebar.tooltip.theme')"
          placement="right"
      >
        <div class="columnCC" style="margin-bottom: 15px; cursor: pointer" @click="onThemeClick">
          <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="14888"
               width="36"
               height="36">
            <path
                d="M298.35 84.69h427.3a213.65 213.65 0 0 1 213.66 213.66v427.3a213.65 213.65 0 0 1-213.66 213.66H298.34A213.65 213.65 0 0 1 84.69 725.66V298.35A213.66 213.66 0 0 1 298.35 84.69z"
                fill="#E8E7E6" p-id="14889"/>
            <path
                d="M792 504.56l-1.34 0.05C777.09 368.79 662.9 262.74 524 262.74c-144.77 0-262.71 115.19-267.82 259.21h23.91l-24 0.81c-3.76 125 67.29 236.09 201.55 273s112.74-61.85 100.78-69.09-20.39-26.83-9.83-49.35 19.64-21.31 68.82-22.21C750.85 657.28 782.39 562 789.75 522h2.06c-0.12-3.29-0.31-6.57-0.54-9.83 0.58-4.83 0.73-7.61 0.73-7.61z m-434 29.65a48.1 48.1 0 1 1 47.84-48.1 48 48 0 0 1-47.84 48.1z m88.6-116.07a48 48 0 1 1 47.95-48 48 48 0 0 1-47.93 48z m150 2.53a48.1 48.1 0 1 1 47.85-48.1 48 48 0 0 1-47.85 48.1z m93.26 113.54a48.1 48.1 0 1 1 47.95-48.1 48 48 0 0 1-47.95 48.1z"
                fill="#DD4F47" p-id="14890"/>
          </svg>
        </div>
      </el-tooltip>
    </div>

  </div>
</template>

<script setup lang="ts">
import {useBasicStore} from '@/store/basic'
import {storeToRefs} from 'pinia/dist/pinia'
import {computed} from 'vue'
import {useRoute, useRouter} from 'vue-router'
import SidebarItem from './SidebarItem.vue'

const router = useRouter();

const basicStore = useBasicStore()
const {allRoutes, resetStateAndToLogin} = storeToRefs(useBasicStore())
const routeInstance = useRoute()
let useConfigStore = reactive({})

const themeList = ['lighting-theme', 'china-red']

setTimeout(() => {
  import('@/store/config').then((res) => {
    useConfigStore = res.useConfigStore
  })
}, 300)

const activeMenu = computed(() => {
  const {meta, path} = routeInstance
  // if set path, the sidebar will highlight the path you set
  if (meta.activeMenu) {
    return meta.activeMenu
  }
  return path
})

function goToHome() {
  router.push('/');
}
const onGotoGitHubClick = () => {
  window.open('https://github.com/code4DB/CrackSQL', '_blank')
}
const onGotoGitHubIssueClick = () => {
  window.open('https://github.com/code4DB/CrackSQL/issues', '_blank')
}
const onExitClick = () => {
  basicStore.resetStateAndToLogin()
}
const onLanguageClick = () => {
  const {language, setLanguage} = useConfigStore()
  setLanguage(language === 'zh' ? 'en' : 'zh')
}
const onThemeClick = () => {
  const {theme, setTheme} = useConfigStore()
  setTheme(themeList[(themeList.indexOf(theme) + 1) % themeList.length])
  console.log('change theme:', theme)
}

</script>
<style lang="scss">
//fix open the item style issue
.el-menu-vertical {
  width: var(--side-bar-width);
}

.reset-menu-style {
  border-right: 1px solid var(--side-bar-border-right-color);
}
</style>
